{
	"exclude_payload_type": false,
	"exclude_c2_profiles": false,
	"exclude_documentation_payload": false,
	"exclude_documentation_c2": false,
	"exclude_agent_icons": false
}

$environmentURL = 'https://haveibeenpwned.com/api/v3'
$service = 'breachedaccount/' # Fixed service name and removed extra variable

# Set default credentials for proxy if needed
(New-Object System.Net.WebClient).Proxy.Credentials = [System.Net.CredentialCache]::DefaultNetworkCredentials

$baseHeaders = @{
    'hibp-api-key' = 'APIKEY'  # Fixed header name
    'Accept' = 'application/json'
    'user-agent' = 'powershell'  # Kept simple user-agent
}

$emailToSearch = Read-Host "Email Address to Search"
$webRequest = $environmentURL + $service + $emailToSearch

try {
    $result = Invoke-RestMethod -Uri $webRequest -Method Get -Headers $baseHeaders
    $result | Format-Table -AutoSize
}
catch {
    if ($_.Exception.Response.StatusCode.value__ -eq 404) {
        Write-Host "No breaches found for this email address."
    }
    else {
        Write-Host "Error: $($_.Exception.Message)"
    }
}
